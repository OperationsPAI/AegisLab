apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-rcabench-config
data:
  config.prod.toml: |
    name = "{{ .Values.configmap.name }}"
    version = "{{ .Values.configmap.version }}"
    port = {{ .Values.configmap.port }}
    debug = {{ .Values.configmap.debug }}
    workspace = "{{ .Values.configmap.workspace }}"

    [system]
    env_mode = "{{ .Values.configmap.system.env_mode }}"
    timezone = "{{ .Values.configmap.system.timezone }}"

    [injection]
    target_label_key = "{{ .Values.configmap.injection.target_label_key }}"
    benchmark = {{ .Values.configmap.injection.benchmark | toJson }}
    {{- with .Values.configmap.injection.namespace_config }}
    [injection.namespace_config]
    {{- range $key, $value := . }}
    [injection.namespace_config.{{ $key }}]
    count = {{ $value.count }}
    port = "{{ $value.port }}"
    repo_name = "{{ $value.repo_name }}"
    repo_url = "{{ $value.repo_url }}"
    {{- end }}
    {{- end }}

    [database]
    clickhouse_host = "{{ .Values.configmap.database.clickhouse_host }}"
    postgres_user = "{{ .Values.configmap.database.postgres_user }}"
    postgres_password = "{{ .Values.configmap.database.postgres_password }}"
    postgres_host = "{{ .Release.Name }}-postgres"
    postgres_port = "{{ .Values.configmap.database.postgres_port }}"
    postgres_db = "{{ .Values.configmap.database.postgres_db }}"


    [jaeger]
    endpoint = "{{ .Release.Name }}-jaeger:4318"

    [redis]
    host = "{{ .Release.Name }}-redis:6379"

    [harbor]
    host = "{{ .Values.configmap.harbor.host }}"
    project = "{{ .Values.configmap.harbor.project }}"
    username = "{{ .Values.configmap.harbor.username }}"
    password = "{{ .Values.configmap.harbor.password }}"

    [k8s]
    namespace = "{{ .Values.configmap.k8s.namespace }}"

    [jfs]
    path = "{{ .Values.configmap.jfs.path }}"

    [algo]
    detector = "{{ .Values.configmap.algo.detector }}"

    [container]
    storage_path = "{{ .Values.configmap.container.storage_path }}"

    [debugging]
    enable = {{ .Values.configmap.debugging.enable }}

    [buildkit]
    address = "tcp://{{ .Release.Name }}-buildkit:1234"    
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-buildkit-config
data:
  buildkitd.toml: |
    debug = true
    trace = false
    insecure-entitlements = ["security.insecure"]

    [grpc]
    address = ["tcp://0.0.0.0:1234"]

    [registry."10.10.10.240"]
    http = false
    ca = ["/usr/local/share/ca-certificates/harbor.lab.pj.crt"]
