# =============================================================================
# Backup-redis Makefile
# =============================================================================
# è¿™ä¸ªMakefileæä¾›äº†Backup-rediså·¥å…·çš„å¿«æ·å‘½ä»¤
# ä½¿ç”¨ 'make help' æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤

# =============================================================================
# é…ç½®å˜é‡
# =============================================================================

# é¢œè‰²å®šä¹‰
BLUE    := \033[1;34m
GREEN   := \033[1;32m
YELLOW  := \033[1;33m
RED     := \033[1;31m
CYAN    := \033[1;36m
GRAY    := \033[90m
RESET   := \033[0m

# =============================================================================
# å£°æ˜æ‰€æœ‰éæ–‡ä»¶ç›®æ ‡
# =============================================================================
.PHONY: help restore-loacl

# =============================================================================
# é»˜è®¤ç›®æ ‡
# =============================================================================
.DEFAULT_GOAL := help

# =============================================================================
# å¸®åŠ©ä¿¡æ¯
# =============================================================================
help: ## ğŸ“– æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
	@awk 'BEGIN { \
		FS = ":.*##"; \
		printf "$(YELLOW)å¯ç”¨å‘½ä»¤:$(RESET)\n"; \
	} \
	/^##@/ { \
		header = substr($$0, 5); \
		printf "\n$(GREEN)â–¶ %s$(RESET)\n", header; \
	} \
	/^[a-zA-Z_-]+:.*?##/ { \
		printf "  $(CYAN)%-25s$(RESET) $(GRAY)%s$(RESET)\n", $$1, $$2; \
	}' $(MAKEFILE_LIST)

# =============================================================================
# è½¬å­˜
# =============================================================================
restore-local: ## ğŸ“¦ ä»æ­£å¼ç¯å¢ƒè½¬å­˜åˆ°æœ¬åœ° Redis
	@read -p "é€‰æ‹©åŒ¹é…æ–¹å¼ - ç²¾å‡†åŒ¹é… (y) æˆ– æ¨¡ç³ŠåŒ¹é… (N): " choice; \
	if [ "$$choice" = "y" ] || [ "$$choice" = "Y" ]; then \
		echo "$(BLUE)ä½¿ç”¨ç²¾å‡†åŒ¹é…æ¨¡å¼...$(RESET)"; \
		uv run python cli.py restore-batch --exact_match --overwrite; \
	else \
		read -p "è¾“å…¥æ¨¡ç³ŠåŒ¹é…æ¨¡å¼: " pattern; \
		echo "$(BLUE)ä½¿ç”¨æ¨¡ç³ŠåŒ¹é…æ¨¡å¼: $$pattern$(RESET)"; \
		uv run python cli.py restore-batch --source_pattern "$$pattern" --overwrite; \
	fi